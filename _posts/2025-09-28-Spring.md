---
title: 'Spring'
date: 2025-09-28
permalink: /posts/2025/04/blog-post-4/
tags:
  - cool posts
  - category1
  - category2
---

👉 [我的项目链接](https://github.com/csjiaweibi/Spring)

框架 === 注解 + 反射 + 设计模式

---

# Spring Boot 请求响应

## Web 服务器（Tomcat）

- Tomcat 是 Servlet 容器，支持 Servlet 规范，可以识别 Servlet 程序。
- Spring Boot 内置核心 Servlet —— `DispatcherServlet`，作为前端控制器：
  - 接收请求
  - 转发请求给 Controller
  - Controller 处理后返回数据，再由 `DispatcherServlet` 响应给浏览器

### 请求数据传递

- Tomcat 接收 HTTP 请求时，将数据封装到 `HttpServletRequest` 对象。
- 在 Controller 中直接声明 `HttpServletRequest` 形参，即可获取请求信息。
- Tomcat 同时传递 `HttpServletResponse`，用于返回数据。

### 参数获取

- Spring Boot 方法中可自动类型转换。
- 参数名与 Controller 形参名一致时，自动注入。
- `@RequestParam` 可显式绑定请求参数。
- **路径参数**：使用 `{}` 占位符，并通过 `@PathVariable` 获取。

---

# 分层解耦

## 分层设计

- **Controller**：控制层，接收请求并响应。
- **Service**：业务逻辑层，处理业务逻辑。
- **Dao**：数据访问层，负责数据增删改查。

## 解耦思想

- **高内聚、低耦合** 原则。
- **控制反转（IoC）**：对象交给容器管理。
- **依赖注入（DI）**：容器在运行时注入所需对象。

---

# IoC

## 核心思想

- 使用 `@Component` 将类交给 IoC 容器管理。
- IoC 容器创建的对象称为 **Bean**。
- 常见衍生注解：
  - `@Controller`
  - `@Service`
  - `@Repository`

## 组件扫描

- Bean 要生效需被 `@ComponentScan` 扫描。
- `@SpringBootApplication` 默认包含 `@ComponentScan`。

---

# DI

- 使用 `@Autowired` 实现依赖注入。
- 解决方案：
  - `@Primary`：优先注入
  - `@Qualifier`：指定 Bean 名称
  - `@Resource`：按名称注入

### @Autowired vs @Resource

- `@Autowired`：Spring 提供，默认按类型注入。
- `@Resource`：JDK 提供，按名称注入。

---

# Bean

## 生命周期

1. **实例化**：通过反射创建对象。
2. **属性赋值**：注入依赖。
3. **初始化**：
   - Aware 接口
   - `BeanPostProcessor`
   - `InitializingBean.afterPropertiesSet()`
   - `init-method`
   - 初始化后再次调用 `BeanPostProcessor`
4. **销毁**：
   - 容器关闭时触发
   - `DisposableBean.destroy()`
   - `destroy-method`
   - `@PreDestroy`

## 线程安全性

- **singleton**：单例 Bean，可能有并发问题。
- **prototype**：每次获取新对象，无线程安全问题。

**解决方式**：
- 设计为无状态 Bean
- 使用 `ThreadLocal`
- 同步控制

---

# 注解

- `@Controller`：控制层
- `@Service`：业务层
- `@Repository`：数据访问层
- `@Component`：通用组件
- `@Autowired` / `@Resource`：依赖注入
- `@ResponseBody`、`@RestController`：Web 响应

---

# IoC 核心容器

## 工作流程

1. **初始化容器**：解析配置，生成 `BeanDefinition`。
2. **实例化 & 注入**：通过反射创建对象并注入依赖。
3. **Bean 使用**：通过 `@Autowired` 或 `getBean()` 获取。
4. **销毁 Bean**：容器关闭时清理资源。

---

# AOP 核心

## 核心概念

- **连接点（JoinPoint）**
- **通知（Advice）**
- **切入点（PointCut）**
- **切面（Aspect）**
- **目标对象（Target）**

### 通知类型

- `@Before`
- `@After`
- `@Around`（重点）
- `@AfterReturning`
- `@AfterThrowing`

### 动态代理机制

- **JDK 动态代理**：基于接口
- **CGLIB 动态代理**：基于类

### 实现步骤

1. 定义切面 `@Aspect`
2. 解析切点
3. 创建代理对象
4. 拦截方法调用
5. 执行增强逻辑
6. 调用目标方法

---

# Web 服务器（Tomcat）

- **Filter**：过滤器，常用于登录校验、统一编码、敏感词过滤
- **Interceptor**：拦截器，Spring 提供，用于拦截 Controller 方法
- **DispatcherServlet**：前端控制器
- **HttpServletRequest**：请求对象
- **Mapper**：数据访问层接口
- **Controller**：控制层，调用 Service
- **Service**：业务逻辑层
- **Entity**：POJO 层，封装数据库表字段

---

# ORM

- Spring 集成 MyBatis、Hibernate 等 ORM 框架。
- 提供 `JdbcTemplate` 简化 JDBC 操作。

---

# 事务管理

- 使用 `@Transactional` 注解：
  - 放在 Service 层方法或类上
  - 默认运行时异常回滚，可配置 `rollbackFor`

## 事务传播行为

- 定义事务方法相互调用时的事务控制方式。

---
